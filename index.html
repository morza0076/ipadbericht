<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Leckortungsbericht">
    <title>Leckortungsbericht</title>
    <style>
        :root { --accent: #b89b1e; --text: #1f1f1f; --bg: #f4f1e8; --border: #ccc; }
        * { box-sizing: border-box; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        
        /* Druckr√§nder rigoros auf 0 setzen - das entfernt Datum und Webadresse! */
        @page { size: A4; margin: 0 !important; }
        
        body { font-family: "Segoe UI", Roboto, Arial, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: var(--text); }
        
        .page { 
            width: 210mm; min-height: 297mm; background: white; padding: 12mm; 
            margin: 0 auto 20px auto; position: relative; box-shadow: 0 0 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 2px solid var(--accent); padding-bottom: 8px; margin-bottom: 12px; }
        .header-left { display: flex; flex-direction: column; gap: 6px; align-items: flex-start; }
        .logo { max-height: 55px; width: auto; object-fit: contain; }
        .header-left h1 { margin: 0; font-size: 22px; color: var(--text); text-transform: uppercase; }
        .header-right { text-align: right; font-size: 10px; line-height: 1.3; }

        .section { margin-bottom: 10px; }
        .section h2 { font-size: 13px; text-transform: uppercase; border-bottom: 1px solid #eee; padding-bottom: 3px; margin-bottom: 6px; color: var(--accent); font-weight: 700; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .label { font-size: 10px; font-weight: bold; margin-bottom: 2px; display: block; color: #555; }
        input, textarea, select { width: 100%; border: 1px solid var(--border); padding: 6px; font-size: 12px; border-radius: 3px; background: white; outline: none; }
        
        textarea { min-height: 40px; font-family: inherit; resize: none; overflow: hidden; line-height: 1.4; }

        .checkbox-group { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 11px; }
        .checkbox-item { display: flex; align-items: center; gap: 4px; cursor: pointer; }
        .checkbox-item input { width: auto; margin: 0; }

        .drawing-area { border: 1px solid var(--border); background: #fafafa; cursor: crosshair; touch-action: none; position: relative; width: 100%; border-radius: 4px; }
        .sketch-box { height: 450px; margin-top: 10px; }
        
        .toolbar { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; background: #eee; padding: 8px; border-radius: 5px; }
        .tool { width: 25px; height: 25px; border-radius: 50%; border: 2px solid white; cursor: pointer; }
        .tool.active { border: 2px solid #000; transform: scale(1.1); }
        .tool.eraser { background: white; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; font-size: 14px; }

        .photo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        .photo-box { border: 1px solid #ddd; padding: 8px; text-align: center; background: #fff; border-radius: 4px; break-inside: avoid; page-break-inside: avoid; }
        .img-container { position: relative; width: 100%; height: 240px; background: #f9f9f9; margin-bottom: 8px; overflow: hidden; cursor: crosshair; }
        .img-container img { width: 100%; height: 100%; object-fit: contain; pointer-events: none; }
        .marker-arrow { position: absolute; width: 40px; height: 40px; transform: translate(-100%, -100%); pointer-events: none; filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5)); }
        .photo-desc { width: 100%; border: none; border-bottom: 1px solid var(--accent); font-size: 12px; padding: 4px 0; }
        
        .footer { position: absolute; bottom: 10mm; left: 12mm; right: 12mm; font-size: 9px; display: flex; justify-content: space-between; color: #888; border-top: 1px solid #eee; padding-top: 5px; }

        #controls { position: fixed; top: 10px; right: 10px; z-index: 100; display: flex; flex-direction: column; gap: 8px; width: 180px; }
        button { padding: 12px; background: var(--accent); color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px; }
        button.secondary { background: #444; }

        @media print { 
            body { background: white; padding: 0; margin: 0; }
            #controls, .toolbar, .no-print, #photoInput { display: none !important; } 
            /* Skizzenseite nur drucken, wenn Checkbox aktiv (Klasse auf body) */
            body:not(.sketch-enabled) #sketchPage { display: none !important; }
            .page { 
                margin: 0 !important; 
                box-shadow: none !important; 
                border: none !important; 
                width: 190mm;              /* etwas kleiner als A4-Breite */
                min-height: auto;          /* feste H√∂he/Min-H√∂he f√ºr Druck entfernen */
                height: auto;
                padding: 8mm 10mm 14mm 10mm; /* etwas weniger oben, mehr unten f√ºr Footer */
                page-break-after: always;
                page-break-inside: avoid;
                break-after: page;
                break-inside: avoid;
            }
            /* Footer beim Druck nicht absolut positionieren, damit nichts abgeschnitten wird */
            .footer {
                position: static;
                margin-top: 6mm;
                left: auto;
                right: auto;
                bottom: auto;
            }
            .page:last-of-type {
                page-break-after: auto;
                break-after: auto;
            }
            input[type="text"], input[type="date"], input[type="number"], textarea, select, .photo-desc {
                border: none !important;
                background: transparent !important;
                padding: 0 !important;
                -webkit-appearance: none;
                appearance: none;
            }
            .drawing-area {
                border: 1px solid #000 !important; 
                background: transparent !important;
            }
            .sketch-box {
                height: 180mm !important;
            }
            .img-container {
                height: 55mm !important;
            }
            .photo-box {
                border-color: #000 !important;
            }
        }
    </style>
</head>
<body>

<div id="controls" class="no-print">
    <button class="secondary" onclick="window.print()">DRUCKEN</button>
    <button class="secondary" onclick="window.print()">ALS PDF SPEICHERN</button>
    <button class="secondary" onclick="clearSketch()">SKIZZE L√ñSCHEN</button>
    <input type="file" id="photoInput" multiple accept="image/*" style="display:none" onchange="handlePhotos(this)">
    <button class="secondary" onclick="document.getElementById('photoInput').click()">FOTOS HINZUF√úGEN</button>
</div>

<div class="page" id="mainPage">
    <div class="header">
        <div class="header-left">
            <img src="Logo.PNG" alt="Brugger Logo" class="logo" onerror="this.style.display='none'">
            <h1>Leckortungsbericht</h1>
        </div>
        <div class="header-right">
            <strong>Brugger Entfeuchtung & Kanaltechnik GmbH</strong><br>
            Liebenauer Hauptstra√üe 181, 8041 Graz<br>
            Tel: +43 316 471771 | office@brugger-entfeuchtung.at
        </div>
    </div>

    <div class="section">
        <h2>Kundendaten</h2>
        <div class="grid">
            <div><span class="label">Kunde / Name</span><input type="text" id="name"></div>
            <div><span class="label">Datum</span><input type="date" id="datum"></div>
        </div>
        <div style="margin-top:6px">
            <span class="label">Einsatzadresse</span>
            <input type="text" id="adresse" placeholder="Stra√üe / Hausnummer">
            <div class="grid" style="margin-top:6px; grid-template-columns: 80px 1fr;">
                <input type="text" id="plz" placeholder="PLZ">
                <input type="text" id="ort" placeholder="Ort">
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Schadensanalyse & Befund</h2>
        <textarea id="befund" placeholder="Ergebnisse der Ortung..."></textarea>
    </div>

    <div class="section grid">
        <div>
            <h2>Ma√ünahmen</h2>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox"> <span>Trocknung</span></label>
                <label class="checkbox-item"><input type="checkbox"> <span>Sanierung</span></label>
                <label class="checkbox-item"><input type="checkbox"> <span>Verstopfungsbehebung</span></label>
                <label class="checkbox-item"><input type="checkbox"> <span>Reparatur</span></label>
                <label class="checkbox-item"><input type="checkbox" id="checkSonstiges" onclick="toggleSonstiges()"> <span>Sonstiges</span></label>
            </div>
            <input type="text" id="inputSonstiges" placeholder="..." style="display:none; margin-top:6px;">
        </div>
        <div>
            <h2>Leistungen</h2>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox"> <span>LO Pauschale</span></label>
                <label class="checkbox-item"><input type="checkbox"> <span>opt. Leckortung</span></label>
                <label class="checkbox-item"><input type="checkbox"> <span>Thermografie</span></label>
                <label class="checkbox-item"><input type="checkbox" id="checkFlachdach"> <span>Flachdach-Pr√ºf.</span></label>
                <label class="checkbox-item"><input type="checkbox"> <span>Pool LO</span></label>
            </div>
            <!-- Auswahl der Standardtexte f√ºr Flachdachf√§lle (nur sichtbar bei aktivierter Flachdach-Pr√ºfung) -->
            <div id="flachdachTextOptions" class="no-print" style="margin-top:6px; display:none;">
                <span class="label">Textvorlage f√ºr Befund</span>
                <select id="flachdachTemplate">
                    <option value="">- w√§hlen -</option>
                    <option value="funkenschlag">Funkenschlag</option>
                    <option value="roofscan">RoofScan</option>
                </select>
            </div>
            <div class="grid" style="margin-top:8px;">
                <div><span class="label">Arbeitszeit (Std)</span><input type="number" step="0.5" placeholder="0.0"></div>
                <div><span class="label">Fahrzeit (Std)</span><input type="number" step="0.5" placeholder="0.0"></div>
            </div>
            <div class="grid" style="margin-top:6px;">
                <div><span class="label">Fahrzone</span><select><option value="">- w√§hlen -</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
                <div><span class="label">Ortungsgas (l)</span><select><option>0</option><option>5</option><option>10</option><option>20</option><option>50</option></select></div>
            </div>
        </div>
    </div>

    <div class="section" id="reparaturSection">
        <h2>Reparatur & Pr√ºfdetails</h2>
        <div style="margin-bottom: 6px;">
            <span class="label">Erforderliche Reparaturarbeiten</span>
            <textarea id="reparatur" placeholder="..."></textarea>
        </div>
        <div class="grid" style="margin-bottom: 8px;">
            <div><span class="label">Betroffene R√§ume</span><input type="text" placeholder="..."></div>
            <div><span class="label">Etage</span><input type="text" placeholder="..."></div>
        </div>
        <div class="checkbox-group" style="grid-template-columns: repeat(3, 1fr);">
            <label class="checkbox-item"><input type="checkbox"> <span>Ursache bereits behoben</span></label>
            <label class="checkbox-item"><input type="checkbox"> <span>Druckabfall</span></label>
            <label class="checkbox-item"><input type="checkbox"> <span>Feuchtigkeit</span></label>
            <label class="checkbox-item"><input type="checkbox"> <span>Tracergas</span></label>
            <label class="checkbox-item"><input type="checkbox"> <span>Endoskopie</span></label>
            <label class="checkbox-item"><input type="checkbox"> <span>Thermografie</span></label>
            <label class="checkbox-item"><input type="checkbox"> <span>Rohrkamera</span></label>
            <label class="checkbox-item"><input type="checkbox"> <span>Druckpr√ºfung</span></label>
            <label class="checkbox-item"><input type="checkbox"> <span>Absperrblase</span></label>
            <label class="checkbox-item"><input type="checkbox"> <span>Nebelverfahren</span></label>
            <label class="checkbox-item"><input type="checkbox"> <span>Luminatsp√ºlung</span></label>
            <label class="checkbox-item"><input type="checkbox"> <span>Feuchtigkeitsmessung</span></label>
            <label class="checkbox-item"><input type="checkbox"> <span>Akustik</span></label>
            <label class="checkbox-item"><input type="checkbox"> <span>Stemmarbeiten</span></label>
            <label class="checkbox-item"><input type="checkbox" id="checkSonstigesReparatur" onclick="toggleSonstigesReparatur()"> <span>Sonstiges</span></label>
        </div>
        <input type="text" id="inputSonstigesReparatur" placeholder="..." style="display:none; margin-top:6px;">
    </div>

    <!-- Steuerung, ob Skizzenseite mitgedruckt werden soll -->
    <div class="section no-print">
        <label class="checkbox-item">
            <input type="checkbox" id="toggleSketch">
            <span>Skizzenseite (Seite 2) beim Bericht verwenden</span>
        </label>
    </div>
    <div class="footer"><span>Brugger GmbH</span><span>Seite 1</span></div>
</div>

<div class="page" id="sketchPage">
    <div class="header">
        <div class="header-left">
            <img src="Logo.PNG" alt="Brugger Logo" class="logo" onerror="this.style.display='none'">
            <h1>Skizze / Grundriss</h1>
        </div>
    </div>
    <div class="toolbar no-print">
        <div class="tool active" style="background:#000" onclick="setTool('#000', 2, this)"></div>
        <div class="tool" style="background:#0000FF" onclick="setTool('#0000FF', 2, this)"></div>
        <div class="tool" style="background:#FF0000" onclick="setTool('#FF0000', 2, this)"></div>
        <div class="tool" style="background:#00AA00" onclick="setTool('#00AA00', 2, this)"></div>
        <div class="tool eraser" onclick="setTool('#fafafa', 15, this)">üßΩ</div>
    </div>
    <canvas id="sketch-canvas" class="drawing-area sketch-box"></canvas>
    <p style="font-size: 10px; color: #777; margin-top:5px; font-weight:bold;">üîµ Wasser | üî¥ Heizung | üü¢ Abfluss</p>
    <div class="footer"><span>Brugger GmbH</span><span>Seite 2</span></div>
</div>

<div id="photoPagesContainer"></div>

<script>
    const dateInput = document.getElementById('datum');
    if (dateInput) {
        try {
            if ('valueAsDate' in dateInput) {
                dateInput.valueAsDate = new Date();
            } else {
                const today = new Date().toISOString().split('T')[0];
                dateInput.value = today;
            }
        } catch (e) {
            const today = new Date().toISOString().split('T')[0];
            dateInput.value = today;
        }
    }
    let currentStyle = '#000'; let currentWidth = 2;

    // Seitentitel dynamisch aus PLZ, Ort und Adresse f√ºr PDF-Dateinamen
    function updateTitleWithAddress() {
        const adresseEl = document.getElementById('adresse');
        const plzEl = document.getElementById('plz');
        const ortEl = document.getElementById('ort');
        const baseTitle = 'Leckortungsbericht';

        if (!adresseEl || !plzEl || !ortEl) {
            document.title = baseTitle;
            return;
        }

        const parts = [
            (plzEl.value || '').trim(),
            (ortEl.value || '').trim(),
            (adresseEl.value || '').trim()
        ].filter(Boolean);

        const all = parts.join(' ');
        document.title = all ? `${baseTitle} - ${all}` : baseTitle;
    }

    // Textfelder wachsen automatisch mit
    function autoResize() {
        this.style.height = 'auto'; 
        this.style.height = (this.scrollHeight + 2) + 'px'; 
    }
    document.querySelectorAll('textarea').forEach(el => { el.addEventListener('input', autoResize); });

    // Titel sofort und bei Adress-√Ñnderung aktualisieren
    const adresseInput = document.getElementById('adresse');
    if (adresseInput) {
        adresseInput.addEventListener('input', updateTitleWithAddress);
        updateTitleWithAddress();
    }

    // Flachdach-Pr√ºfung: Reparatur-Block ausblenden, Skizzenseite ausblenden, Textvorlagen anbieten
    const checkFlachdach = document.getElementById('checkFlachdach');
    const reparaturSection = document.getElementById('reparaturSection');
    const befundTextarea = document.getElementById('befund');
    const flachdachTextOptions = document.getElementById('flachdachTextOptions');
    const flachdachTemplateSelect = document.getElementById('flachdachTemplate');

    const FLACHDACH_TEXT_FUNKENSCHLAG =
`√úberpr√ºfung der Kunststoff Flachdachabdichtung des Hauptdaches mittels Funkenschlagverfahren.

Die Leckageortung mit dem Funkenschlagverfahren (Trockenortungsverfahren) ist f√ºr das Auffinden von L√∂chern und Rissen auf nicht leitf√§higen Beschichtungen oder Abdichtungen ohne Auflastung geeignet.
Das Hochspannung-Verfahren sp√ºrt feinste kapillare Undichtigkeiten auf. Beim Funkenschlagverfahren wird Hochspannung verwendet, die √ºber eine Kupferb√ºrste auf die zu pr√ºfende Abdichtung √ºbertragen wird.
Mit dem Funkenschlagverfahren k√∂nnen auch Punkt- und Nahtortungen durchgef√ºhrt werden.
Die H√∂he der elektrischen Spannung richtet sich nach der Schichtdicke des zu pr√ºfenden Materials.
Damit k√∂nnen Leckagen durch Funkenentladung, sowie durch optische und akustische Anzeige, sichtbar gemacht und punktgenau geortet werden.

Bei der √úberpr√ºfung der Flachdachfl√§che des Hauptdaches wurden 24 Verdachtsbereiche festgestellt.`;

    const FLACHDACH_TEXT_ROOFSCAN =
`1. Ausgangssituation:
An der Decke im 1. Untergeschoss wurde ein Wassereintritt im Bereich eines Gullys festgestellt.
Dar√ºber befindet sich die Flachdachabdichtung der Terrasse.

Der Aufbau des Flachdaches stellt sich wie folgt dar:
- Stahlbetondecke
- Abdichtung
- Isolierung
- Kies
- Betonplatten

Zur Lokalisierung der Wasserdurchtritte wurden Untersuchungen mittels einer Potential-Differenzmessung durchgef√ºhrt.
Es wurde nur ein Teilbereich der Terrasse √ºberpr√ºft.

2. Durchf√ºhrung der Messung und vorbereitende Ma√ünahmen:
Zur Charakterisierung von m√∂glichen Leckagen im Abdichtungssystem wurden gerichtete elektrische Felder zwischen der Einspeisung an der Schadstelle und einem mobilen Sensor im Messbereich erzeugt. Wegsamkeitsbereiche durch das Abdichtungssystem √§u√üern sich durch erh√∂hte Energiedurchtritte des Tracersignals.

3. Untersuchungsergebnisse:
Es wurde zum Zeitpunkt der √úberpr√ºfung ein Verdachtsbereich V1 ermittelt.
Der Verdachtsbereich befindet sich ca. 3 m neben dem betroffenen Gully.
Da eine punktuelle Lokalisierung der Undichtheit aufgrund der Witterung nicht m√∂glich ist, wird empfohlen, die gesamte Flachdachfl√§che nach einem Niederschlag nochmals zu pr√ºfen.`;

    // Checkbox: steuert, ob Skizzenseite beim Drucken verwendet wird
    const toggleSketch = document.getElementById('toggleSketch');
    const sketchPage = document.getElementById('sketchPage');
    if (toggleSketch) {
        // Standard: Skizzenseite NICHT verwenden, bis explizit angehakt
        document.body.classList.remove('sketch-enabled');
        toggleSketch.addEventListener('change', () => {
            if (toggleSketch.checked) {
                document.body.classList.add('sketch-enabled');
                if (sketchPage) sketchPage.style.display = '';
            } else {
                document.body.classList.remove('sketch-enabled');
            }
        });
    }

    function applyFlachdachState() {
        if (!checkFlachdach) return;
        if (checkFlachdach.checked) {
            if (reparaturSection) reparaturSection.style.display = 'none';
            if (flachdachTextOptions) flachdachTextOptions.style.display = 'block';
            // Skizzenseite komplett ausblenden und Checkbox deaktivieren
            if (sketchPage) sketchPage.style.display = 'none';
            if (toggleSketch) {
                toggleSketch.checked = false;
                document.body.classList.remove('sketch-enabled');
            }
        } else {
            if (reparaturSection) reparaturSection.style.display = '';
            if (flachdachTextOptions) flachdachTextOptions.style.display = 'none';
            if (sketchPage) sketchPage.style.display = '';
        }
    }

    if (checkFlachdach) {
        checkFlachdach.addEventListener('change', applyFlachdachState);
        // Zustand initial anwenden (falls beim Laden schon angehakt)
        applyFlachdachState();
    }

    if (flachdachTemplateSelect && befundTextarea) {
        flachdachTemplateSelect.addEventListener('change', () => {
            if (flachdachTemplateSelect.value === 'funkenschlag') {
                befundTextarea.value = FLACHDACH_TEXT_FUNKENSCHLAG;
            } else if (flachdachTemplateSelect.value === 'roofscan') {
                befundTextarea.value = FLACHDACH_TEXT_ROOFSCAN;
            } else {
                return;
            }
            autoResize.call(befundTextarea);
        });
    }

    function initDrawing(canvasId) {
        const canvas = document.getElementById(canvasId);
        const ctx = canvas.getContext('2d');
        let drawing = false;
        function resize() {
            const rect = canvas.getBoundingClientRect();
            const temp = canvas.toDataURL();
            canvas.width = rect.width; canvas.height = rect.height;
            const img = new Image(); img.onload = () => ctx.drawImage(img, 0, 0); img.src = temp;
        }
        window.addEventListener('load', resize);
        window.addEventListener('resize', resize);
        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            return { x: clientX - rect.left, y: clientY - rect.top };
        }
        canvas.addEventListener('mousedown', () => { drawing = true; ctx.beginPath(); });
        canvas.addEventListener('mousemove', (e) => {
            if (!drawing) return;
            const pos = getPos(e);
            ctx.lineWidth = currentWidth; 
            ctx.lineCap = 'round'; 
            ctx.strokeStyle = currentStyle;
            ctx.lineTo(pos.x, pos.y); ctx.stroke();
        });
        window.addEventListener('mouseup', () => drawing = false);
        canvas.addEventListener('touchstart', (e) => { drawing = true; ctx.beginPath(); e.preventDefault(); }, {passive: false});
        canvas.addEventListener('touchmove', (e) => {
            if (!drawing) return;
            const pos = getPos(e);
            ctx.lineWidth = currentWidth; 
            ctx.lineCap = 'round'; 
            ctx.strokeStyle = currentStyle;
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            e.preventDefault();
        }, {passive: false});
        canvas.addEventListener('touchend', () => drawing = false);
        return ctx;
    }

    const sketchCtx = initDrawing('sketch-canvas');
    
    function setTool(color, width, el) {
        currentStyle = color; currentWidth = width;
        document.querySelectorAll('.tool').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
    }

    function toggleSonstiges() {
        const check = document.getElementById('checkSonstiges');
        document.getElementById('inputSonstiges').style.display = check.checked ? 'block' : 'none';
    }

    function toggleSonstigesReparatur() {
        const check = document.getElementById('checkSonstigesReparatur');
        document.getElementById('inputSonstigesReparatur').style.display = check.checked ? 'block' : 'none';
    }

    function handlePhotos(input) {
        const container = document.getElementById('photoPagesContainer');
        container.innerHTML = "";
        const files = Array.from(input.files);
        for (let i = 0; i < files.length; i += 4) {
            const page = document.createElement('div');
            page.className = 'page';
            page.innerHTML = `<div class="header"><div class="header-left"><img src="Logo.PNG" alt="Brugger Logo" class="logo" onerror="this.style.display='none'"><h1>Fotodokumentation</h1></div></div><div class="photo-grid" id="grid-${i}"></div><div class="footer"><span>Brugger GmbH</span><span>Seite ${Math.floor(i/4)+3}</span></div>`;
            container.appendChild(page);
            files.slice(i, i + 4).forEach((file) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const box = document.createElement('div'); box.className = 'photo-box';
                    box.innerHTML = `<div class="img-container" onclick="addArrow(event, this)"><img src="${e.target.result}"></div><input type="text" class="photo-desc" placeholder="Beschreibung...">`;
                    document.getElementById(`grid-${i}`).appendChild(box);
                };
                reader.readAsDataURL(file);
            });
        }
    }

    function addArrow(e, container) {
        const old = container.querySelector('.marker-arrow'); if (old) old.remove();
        const rect = container.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;
        const arrow = document.createElement('div');
        arrow.className = 'marker-arrow'; arrow.style.left = x + '%'; arrow.style.top = y + '%';
        arrow.innerHTML = `<svg viewBox="0 0 100 100" fill="red"><path d="M10 10 L90 90 M90 50 L90 90 L50 90" stroke="white" stroke-width="5"/><path d="M10 10 L90 90 M90 55 L90 90 L55 90" fill="red"/></svg>`;
        container.appendChild(arrow);
    }

    function clearSketch() {
        const canvas = document.getElementById('sketch-canvas');
        sketchCtx.clearRect(0, 0, canvas.width, canvas.height);
    }
</script>
</body>
</html>